<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì›ìƒê´€ë¦¬ Pro - ê´€ë¦¬ì</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    *{font-family:-apple-system,'Malgun Gothic',sans-serif;box-sizing:border-box}
    .sidebar-item.active{background:rgba(99,102,241,.15);color:#4f46e5;border-left:3px solid #4f46e5}
  </style>
</head>
<body class="bg-gray-100">
<div id="app"></div>
<script>
const SUPABASE_URL = 'https://sniabexwdgeepakkxxek.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNuaWFiZXh3ZGdlZXBha2t4eGVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MDMxNzIsImV4cCI6MjA4NTA3OTE3Mn0.RsDQDyawjFk5voFLVouXDlTIXvhPrsziCD37ne-1jMU';
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ì–´ë“œë¯¼ ë¹„ë°€ë²ˆí˜¸ (ì‹¤ì œë¡  í™˜ê²½ë³€ìˆ˜ë‚˜ DBë¡œ)
const ADMIN_PW = 'bada2026!';

let page = 'login';
let tab = 'dashboard';
let academies = [];
let ads = [];
let loading = false;

// ì¹´í…Œê³ ë¦¬ ëª©ë¡
const allCategories = [
  'ì˜ì–´', 'ì¤‘êµ­ì–´', 'ì¼ë³¸ì–´', 'ê¸°íƒ€ì™¸êµ­ì–´',
  'í”¼ì•„ë…¸', 'ë°”ì´ì˜¬ë¦°/ì²¼ë¡œ', 'ê¸°íƒ€/ìš°ì¿¨ë ë ˆ', 'ë“œëŸ¼/íƒ€ì•…ê¸°', 'ë³´ì»¬/ì„±ì•…', 'ì‘ê³¡/ë¯¸ë””',
  'ë¯¸ìˆ (íšŒí™”)', 'ë§Œí™”/ì›¹íˆ°', 'ê³µì˜ˆ/ë„ì˜ˆ', 'ì„œì˜ˆ/ìº˜ë¦¬',
  'íƒœê¶Œë„', 'í•©ê¸°ë„/ìœ ë„/ê²€ë„', 'ìˆ˜ì˜', 'ë°œë ˆ/ë¬´ìš©', 'ì²´ì¡°/ì¤„ë„˜ê¸°', 'ì¶•êµ¬/ë†êµ¬', 'í—¬ìŠ¤/PT', 'í•„ë¼í…ŒìŠ¤/ìš”ê°€', 'ê³¨í”„', 'í´ë¼ì´ë°',
  'êµ­ì–´/ë…¼ìˆ ', 'ìˆ˜í•™', 'ì˜ì–´(ì…ì‹œ)', 'ê³¼í•™', 'ì‚¬íšŒ/ì—­ì‚¬', 'ì¢…í•©ì…ì‹œ', 'ë³´ìŠµ/ê³µë¶€ë°©',
  'ì½”ë”©', 'ì»´í“¨í„°í™œìš©', 'ìê²©ì¦',
  'ìš”ë¦¬/ë² ì´í‚¹', 'ë°”ë‘‘/ì²´ìŠ¤', 'ë…ì„œ/í† ë¡ ', 'ê¸°íƒ€'
];

async function init() {
  render();
}

function login() {
  const pw = document.getElementById('adminPw').value;
  if (pw === ADMIN_PW) {
    page = 'main';
    loadData();
  } else {
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤');
  }
}

async function loadData() {
  loading = true;
  render();
  
  const { data: a } = await db.from('academies').select('*').order('created_at', { ascending: false });
  academies = a || [];
  
  const { data: ad } = await db.from('ads').select('*').order('category');
  ads = ad || [];
  
  loading = false;
  render();
}

function render() {
  const app = document.getElementById('app');
  if (page === 'login') {
    app.innerHTML = renderLogin();
  } else {
    app.innerHTML = renderMain();
  }
}

function renderLogin() {
  return `
    <div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center p-4">
      <div class="w-full max-w-sm">
        <div class="text-center mb-8">
          <div class="w-20 h-20 bg-white rounded-3xl flex items-center justify-center mx-auto mb-4 text-4xl">ğŸ”</div>
          <h1 class="text-2xl font-bold text-white">ê´€ë¦¬ì í˜ì´ì§€</h1>
          <p class="text-slate-400 mt-1">ì›ìƒê´€ë¦¬ Pro</p>
        </div>
        <div class="bg-white rounded-2xl p-6 shadow-xl">
          <input type="password" id="adminPw" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸" 
            class="w-full px-4 py-3 border rounded-xl mb-4"
            onkeypress="if(event.key==='Enter')login()">
          <button onclick="login()" class="w-full py-3 bg-slate-800 text-white font-bold rounded-xl hover:bg-slate-700">
            ë¡œê·¸ì¸
          </button>
        </div>
      </div>
    </div>
  `;
}

function renderMain() {
  const menus = [
    { id: 'dashboard', icon: 'ğŸ“Š', label: 'ëŒ€ì‹œë³´ë“œ' },
    { id: 'academies', icon: 'ğŸ¢', label: 'í•™ì› ê´€ë¦¬' },
    { id: 'ads', icon: 'ğŸ¯', label: 'ê´‘ê³  ê´€ë¦¬' },
    { id: 'subscriptions', icon: 'ğŸ’°', label: 'êµ¬ë… í˜„í™©' },
    { id: 'settings', icon: 'âš™ï¸', label: 'ì„¤ì •' }
  ];
  
  // í†µê³„
  const totalAcademies = academies.length;
  const thisMonth = academies.filter(a => {
    const created = new Date(a.created_at);
    const now = new Date();
    return created.getMonth() === now.getMonth() && created.getFullYear() === now.getFullYear();
  }).length;
  
  // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
  const catStats = {};
  academies.forEach(a => {
    (a.categories || []).forEach(c => {
      catStats[c] = (catStats[c] || 0) + 1;
    });
  });
  
  let h = `
    <div class="flex min-h-screen">
      <!-- ì‚¬ì´ë“œë°” -->
      <aside class="w-64 bg-slate-900 text-white flex flex-col fixed h-full">
        <div class="p-4 border-b border-slate-700">
          <div class="flex items-center gap-3">
            <span class="text-2xl">ğŸ”</span>
            <div>
              <div class="font-bold">ì›ìƒê´€ë¦¬ Pro</div>
              <div class="text-xs text-slate-400">ê´€ë¦¬ì</div>
            </div>
          </div>
        </div>
        <nav class="flex-1 py-4">
          ${menus.map(m => `
            <button onclick="tab='${m.id}';render()" 
              class="w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-800 sidebar-item ${tab === m.id ? 'active' : ''}">
              <span class="text-xl">${m.icon}</span>
              <span>${m.label}</span>
            </button>
          `).join('')}
        </nav>
        <div class="p-4 border-t border-slate-700">
          <button onclick="page='login';render()" class="w-full py-2 bg-slate-700 rounded-lg text-sm">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </aside>
      
      <!-- ë©”ì¸ -->
      <main class="flex-1 ml-64 p-6">
        <div class="mb-6">
          <h1 class="text-2xl font-bold">${menus.find(m => m.id === tab)?.label || ''}</h1>
        </div>
  `;
  
  // ëŒ€ì‹œë³´ë“œ
  if (tab === 'dashboard') {
    h += `
      <div class="grid grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <div class="text-gray-500 text-sm">ì „ì²´ í•™ì›</div>
          <div class="text-3xl font-bold text-indigo-600 mt-1">${totalAcademies}</div>
        </div>
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <div class="text-gray-500 text-sm">ì´ë²ˆë‹¬ ì‹ ê·œ</div>
          <div class="text-3xl font-bold text-emerald-600 mt-1">${thisMonth}</div>
        </div>
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <div class="text-gray-500 text-sm">ë“±ë¡ëœ ê´‘ê³ </div>
          <div class="text-3xl font-bold text-amber-600 mt-1">${ads.length}</div>
        </div>
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <div class="text-gray-500 text-sm">ì˜¤ëŠ˜ ì¿ íŒ¡ í™•ë¥ </div>
          <div class="text-3xl font-bold text-rose-600 mt-1">${getTodayRate().toFixed(2)}%</div>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-6">
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <h3 class="font-bold mb-4">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ í•™ì› ìˆ˜</h3>
          <div class="space-y-2 max-h-80 overflow-y-auto">
            ${Object.entries(catStats).sort((a,b) => b[1] - a[1]).map(([cat, count]) => `
              <div class="flex items-center gap-3">
                <div class="flex-1 text-sm">${cat}</div>
                <div class="w-32 bg-gray-200 rounded-full h-2">
                  <div class="bg-indigo-500 h-2 rounded-full" style="width: ${count/totalAcademies*100}%"></div>
                </div>
                <div class="w-8 text-right text-sm font-medium">${count}</div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <h3 class="font-bold mb-4">ğŸ†• ìµœê·¼ ê°€ì… í•™ì›</h3>
          <div class="space-y-3">
            ${academies.slice(0, 5).map(a => `
              <div class="flex items-center justify-between py-2 border-b">
                <div>
                  <div class="font-medium">${a.name}</div>
                  <div class="text-xs text-gray-400">${(a.categories || []).join(', ') || 'ë¯¸ì„¤ì •'}</div>
                </div>
                <div class="text-xs text-gray-500">${new Date(a.created_at).toLocaleDateString('ko-KR')}</div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
    `;
  }
  
  // í•™ì› ê´€ë¦¬
  else if (tab === 'academies') {
    h += `
      <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
        <div class="p-4 border-b flex justify-between items-center">
          <div class="text-sm text-gray-500">ì´ ${academies.length}ê°œ í•™ì›</div>
          <input type="text" id="searchAcademy" placeholder="í•™ì›ëª… ê²€ìƒ‰..." 
            class="px-4 py-2 border rounded-xl text-sm" onkeyup="filterAcademies()">
        </div>
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">í•™ì›ëª…</th>
              <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">ì›ì¥</th>
              <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">ì¹´í…Œê³ ë¦¬</th>
              <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">ê°€ì…ì¼</th>
              <th class="px-4 py-3 text-left text-sm font-medium text-gray-600">ìš”ê¸ˆì œ</th>
              <th class="px-4 py-3 text-center text-sm font-medium text-gray-600">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="academyList">
            ${academies.map(a => `
              <tr class="border-b hover:bg-gray-50 academy-row" data-name="${a.name}">
                <td class="px-4 py-3">
                  <div class="font-medium">${a.name}</div>
                  <div class="text-xs text-gray-400">${a.id.slice(0,8)}...</div>
                </td>
                <td class="px-4 py-3 text-sm">${a.owner || '-'}</td>
                <td class="px-4 py-3">
                  <div class="flex flex-wrap gap-1">
                    ${(a.categories || []).slice(0,3).map(c => `<span class="px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs">${c}</span>`).join('')}
                    ${(a.categories || []).length > 3 ? `<span class="text-xs text-gray-400">+${a.categories.length - 3}</span>` : ''}
                  </div>
                </td>
                <td class="px-4 py-3 text-sm text-gray-500">${new Date(a.created_at).toLocaleDateString('ko-KR')}</td>
                <td class="px-4 py-3">
                  <span class="px-2 py-1 rounded text-xs ${a.plan === 'business' ? 'bg-purple-100 text-purple-700' : a.plan === 'pro' ? 'bg-indigo-100 text-indigo-700' : 'bg-gray-100 text-gray-700'}">
                    ${a.plan || 'basic'}
                  </span>
                </td>
                <td class="px-4 py-3 text-center">
                  <button onclick="viewAcademy('${a.id}')" class="px-2 py-1 text-sm text-indigo-600 hover:bg-indigo-50 rounded">ìƒì„¸</button>
                  <button onclick="deleteAcademy('${a.id}')" class="px-2 py-1 text-sm text-red-600 hover:bg-red-50 rounded">ì‚­ì œ</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    `;
  }
  
  // ê´‘ê³  ê´€ë¦¬
  else if (tab === 'ads') {
    h += `
      <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
        <h4 class="font-bold text-amber-800 mb-2">ğŸ¯ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ê´‘ê³  ì„¤ì •</h4>
        <p class="text-sm text-amber-700">ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì¿ íŒ¡ ë§í¬ë¥¼ ì„¤ì •í•˜ë©´, í•´ë‹¹ ì¹´í…Œê³ ë¦¬ í•™ì›ì˜ í•™ë¶€ëª¨/í•™ìƒ í˜ì´ì§€ì— ë…¸ì¶œë©ë‹ˆë‹¤.</p>
        <p class="text-sm text-amber-700 mt-1">ì˜¤ëŠ˜ì˜ ì¿ í‚¤ ì‹¬ê¸° í™•ë¥ : <strong>${getTodayRate().toFixed(2)}%</strong> (ë§¤ì¼ 3~10% ëœë¤)</p>
      </div>
      
      <div class="flex justify-end mb-4">
        <button onclick="openAdModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl">+ ê´‘ê³  ì¶”ê°€</button>
      </div>
      
      <div class="grid grid-cols-2 lg:grid-cols-3 gap-4">
        ${ads.map(ad => `
          <div class="bg-white rounded-2xl p-5 shadow-sm border ${ad.active ? 'border-green-200' : 'border-gray-200'}">
            <div class="flex justify-between items-start mb-3">
              <span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-sm">${ad.category}</span>
              <span class="px-2 py-1 rounded text-xs ${ad.active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}">${ad.active ? 'í™œì„±' : 'ë¹„í™œì„±'}</span>
            </div>
            <div class="font-medium mb-2">${ad.name || 'ê´‘ê³ '}</div>
            <div class="text-xs text-gray-400 truncate mb-3">${ad.coupang_url || '-'}</div>
            <div class="flex gap-2">
              <button onclick="editAd('${ad.id}')" class="flex-1 py-2 border rounded-lg text-sm">ìˆ˜ì •</button>
              <button onclick="toggleAd('${ad.id}', ${!ad.active})" class="flex-1 py-2 ${ad.active ? 'bg-gray-100' : 'bg-green-100'} rounded-lg text-sm">
                ${ad.active ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
              </button>
              <button onclick="deleteAd('${ad.id}')" class="px-3 py-2 bg-red-100 text-red-600 rounded-lg text-sm">ì‚­ì œ</button>
            </div>
          </div>
        `).join('')}
        
        ${ads.length === 0 ? `
          <div class="col-span-full text-center py-12 text-gray-400">
            <div class="text-4xl mb-3">ğŸ¯</div>
            <p>ë“±ë¡ëœ ê´‘ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          </div>
        ` : ''}
      </div>
      
      <div class="mt-8 bg-white rounded-2xl p-5 shadow-sm">
        <h3 class="font-bold mb-4">ğŸ“‹ ì¹´í…Œê³ ë¦¬ë³„ ê´‘ê³  í˜„í™©</h3>
        <div class="grid grid-cols-4 gap-2 text-sm">
          ${allCategories.map(cat => {
            const hasAd = ads.some(a => a.category === cat && a.active);
            return `<div class="px-3 py-2 rounded ${hasAd ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500'}">${cat}</div>`;
          }).join('')}
        </div>
      </div>
    `;
  }
  
  // êµ¬ë… í˜„í™©
  else if (tab === 'subscriptions') {
    const plans = { basic: 0, pro: 0, business: 0 };
    academies.forEach(a => {
      const plan = a.plan || 'basic';
      plans[plan]++;
    });
    const monthlyRevenue = plans.basic * 8900 + plans.pro * 14900 + plans.business * 38900;
    
    h += `
      <div class="grid grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <div class="text-gray-500 text-sm">Basic</div>
          <div class="text-3xl font-bold mt-1">${plans.basic}</div>
          <div class="text-sm text-gray-400">Ã— 8,900ì›</div>
        </div>
        <div class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl p-5 shadow-sm">
          <div class="text-indigo-100 text-sm">Pro</div>
          <div class="text-3xl font-bold mt-1">${plans.pro}</div>
          <div class="text-sm text-indigo-200">Ã— 14,900ì›</div>
        </div>
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <div class="text-gray-500 text-sm">Business</div>
          <div class="text-3xl font-bold mt-1">${plans.business}</div>
          <div class="text-sm text-gray-400">Ã— 38,900ì›</div>
        </div>
        <div class="bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-2xl p-5 shadow-sm">
          <div class="text-emerald-100 text-sm">ì˜ˆìƒ ì›” ë§¤ì¶œ</div>
          <div class="text-3xl font-bold mt-1">${(monthlyRevenue / 10000).toFixed(1)}ë§Œ</div>
          <div class="text-sm text-emerald-200">ì›</div>
        </div>
      </div>
      
      <div class="bg-white rounded-2xl p-5 shadow-sm">
        <h3 class="font-bold mb-4">ìš”ê¸ˆì œë³„ í•™ì› ëª©ë¡</h3>
        <div class="space-y-4">
          ${['business', 'pro', 'basic'].map(plan => {
            const list = academies.filter(a => (a.plan || 'basic') === plan);
            if (list.length === 0) return '';
            return `
              <div>
                <div class="font-medium mb-2 ${plan === 'business' ? 'text-purple-600' : plan === 'pro' ? 'text-indigo-600' : 'text-gray-600'}">
                  ${plan.toUpperCase()} (${list.length}ê°œ)
                </div>
                <div class="flex flex-wrap gap-2">
                  ${list.map(a => `<span class="px-3 py-1 bg-gray-100 rounded-full text-sm">${a.name}</span>`).join('')}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
  }
  
  // ì„¤ì •
  else if (tab === 'settings') {
    h += `
      <div class="max-w-2xl space-y-6">
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <h3 class="font-bold mb-4">ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
          <input type="password" id="newPw" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-2 border rounded-xl mb-3">
          <button onclick="alert('ì‹¤ì œ êµ¬í˜„ ì‹œ í™˜ê²½ë³€ìˆ˜ë‚˜ DBë¡œ ê´€ë¦¬')" class="px-4 py-2 bg-indigo-600 text-white rounded-xl">ë³€ê²½</button>
        </div>
        
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <h3 class="font-bold mb-4">ğŸ“Š ì¿ íŒ¡ í™•ë¥  í™•ì¸</h3>
          <p class="text-sm text-gray-600 mb-3">ë‚ ì§œ ê¸°ë°˜ ì‹œë“œë¡œ ë§¤ì¼ ìë™ ê²°ì •ë©ë‹ˆë‹¤.</p>
          <div class="grid grid-cols-7 gap-2 text-center text-sm">
            ${Array.from({length: 7}, (_, i) => {
              const d = new Date();
              d.setDate(d.getDate() + i);
              const rate = getRateForDate(d);
              return `<div class="p-2 bg-gray-50 rounded">
                <div class="text-gray-400 text-xs">${d.getMonth()+1}/${d.getDate()}</div>
                <div class="font-bold text-indigo-600">${rate.toFixed(1)}%</div>
              </div>`;
            }).join('')}
          </div>
        </div>
        
        <div class="bg-white rounded-2xl p-5 shadow-sm">
          <h3 class="font-bold mb-4">ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤</h3>
          <p class="text-sm text-gray-600 mb-3">Supabase í”„ë¡œì íŠ¸: sniabexwdgeepakkxxek</p>
          <a href="https://supabase.com/dashboard" target="_blank" class="px-4 py-2 bg-emerald-600 text-white rounded-xl inline-block">Supabase ëŒ€ì‹œë³´ë“œ</a>
        </div>
      </div>
    `;
  }
  
  h += `
      </main>
    </div>
  `;
  
  return h;
}

// ì˜¤ëŠ˜ ì¿ íŒ¡ í™•ë¥ 
function getTodayRate() {
  return getRateForDate(new Date());
}

function getRateForDate(date) {
  const seed = date.getFullYear() * 10000 + (date.getMonth()+1) * 100 + date.getDate();
  const x = Math.sin(seed) * 10000;
  const rand = x - Math.floor(x);
  return 3 + rand * 7;
}

// í•™ì› ê²€ìƒ‰
function filterAcademies() {
  const q = document.getElementById('searchAcademy').value.toLowerCase();
  document.querySelectorAll('.academy-row').forEach(row => {
    const name = row.dataset.name.toLowerCase();
    row.style.display = name.includes(q) ? '' : 'none';
  });
}

// í•™ì› ìƒì„¸
function viewAcademy(id) {
  const a = academies.find(x => x.id === id);
  if (!a) return;
  alert(`í•™ì›: ${a.name}\nì›ì¥: ${a.owner}\nì—°ë½ì²˜: ${a.phone || '-'}\nì£¼ì†Œ: ${a.address || '-'}\nì¹´í…Œê³ ë¦¬: ${(a.categories || []).join(', ')}\nìš”ê¸ˆì œ: ${a.plan || 'basic'}\nê°€ì…ì¼: ${new Date(a.created_at).toLocaleDateString('ko-KR')}`);
}

// í•™ì› ì‚­ì œ
async function deleteAcademy(id) {
  if (!confirm('ì •ë§ ì´ í•™ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;
  await db.from('academies').delete().eq('id', id);
  await loadData();
}

// ê´‘ê³  ëª¨ë‹¬
let editingAdId = null;

function openAdModal(id = null) {
  editingAdId = id;
  const ad = id ? ads.find(a => a.id === id) : null;
  
  const modal = document.createElement('div');
  modal.id = 'adModal';
  modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4';
  modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
  
  modal.innerHTML = `
    <div class="bg-white rounded-2xl w-full max-w-md">
      <div class="p-4 border-b flex justify-between">
        <span class="font-bold">${ad ? 'ê´‘ê³  ìˆ˜ì •' : 'ê´‘ê³  ì¶”ê°€'}</span>
        <button onclick="document.getElementById('adModal').remove()">âœ•</button>
      </div>
      <div class="p-4 space-y-3">
        <select id="adCategory" class="w-full px-4 py-2 border rounded-xl">
          <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
          ${allCategories.map(c => `<option value="${c}" ${ad?.category === c ? 'selected' : ''}>${c}</option>`).join('')}
        </select>
        <input type="text" id="adName" value="${ad?.name || ''}" placeholder="ê´‘ê³ ëª…" class="w-full px-4 py-2 border rounded-xl">
        <input type="url" id="adUrl" value="${ad?.coupang_url || ''}" placeholder="ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ URL" class="w-full px-4 py-2 border rounded-xl">
        <div class="flex gap-2 pt-2">
          <button onclick="document.getElementById('adModal').remove()" class="flex-1 py-2 border rounded-xl">ì·¨ì†Œ</button>
          <button onclick="saveAd()" class="flex-1 py-2 bg-indigo-600 text-white rounded-xl">ì €ì¥</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

function editAd(id) {
  openAdModal(id);
}

async function saveAd() {
  const category = document.getElementById('adCategory').value;
  const name = document.getElementById('adName').value;
  const coupang_url = document.getElementById('adUrl').value;
  
  if (!category) {
    alert('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”');
    return;
  }
  
  if (editingAdId) {
    await db.from('ads').update({ category, name, coupang_url }).eq('id', editingAdId);
  } else {
    await db.from('ads').insert({ category, name, coupang_url, active: true });
  }
  
  document.getElementById('adModal').remove();
  editingAdId = null;
  await loadData();
}

async function toggleAd(id, active) {
  await db.from('ads').update({ active }).eq('id', id);
  await loadData();
}

async function deleteAd(id) {
  if (!confirm('ì´ ê´‘ê³ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  await db.from('ads').delete().eq('id', id);
  await loadData();
}

init();
</script>
</body>
</html>
