<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ì›ìƒê´€ë¦¬ Pro - ë°ëª¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    *{font-family:-apple-system,'Malgun Gothic',sans-serif;box-sizing:border-box}
    .sidebar-item.active{background:rgba(99,102,241,.15);color:#4f46e5;border-right:3px solid #4f46e5}
    [contenteditable]:focus{outline:2px solid #6366f1;outline-offset:2px}
  </style>
</head>
<body class="bg-gray-100">
<div id="app"></div>
<script>
var academy={name:'EDUì˜ì–´í•™ì›',address:'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',phone:'02-555-1234',owner:'ê¹€ì˜ì–´',bizNo:'123-45-67890'};
var ads={coupang:'https://link.coupang.com/a/dAp1QF',text:'ğŸ“š ì˜ì–´êµì¬ ë² ìŠ¤íŠ¸ì…€ëŸ¬ ìµœëŒ€ 50% í• ì¸!'};

var page='login',userType='',user=null,tab='dashboard',modal='',editingId=null,selectedDays=[],selectedStudents={},docStudentId='',currentDoc=null,viewStudentId=null,attTab='today',smsText='';

var students=[
  {id:1,name:'ê¹€ë¯¼ì¤€',phone:'010-1234-5678',pPhone:'010-9999-0001',course:'ì´ˆë“±ì˜ì–´',level:'Level3',fee:180000,paid:true,paidDate:'2025-01-20',days:['ì›”','ìˆ˜','ê¸ˆ'],time:'15:00',hw:[{id:1,t:'Phonics Unit5',done:false}],memo:'ì§‘ì¤‘ë ¥ ì¢‹ìŒ',attHistory:[{date:'2025-01-24',status:'ì¶œì„'},{date:'2025-01-22',status:'ì¶œì„'},{date:'2025-01-20',status:'ê²°ì„'}]},
  {id:2,name:'ì´ì„œìœ¤',phone:'010-2345-6789',pPhone:'010-9999-0002',course:'ì¤‘ë“±ì˜ì–´',level:'Level5',fee:220000,paid:true,paidDate:'2025-01-18',days:['í™”','ëª©'],time:'17:00',hw:[],memo:'',attHistory:[{date:'2025-01-23',status:'ì¶œì„'},{date:'2025-01-21',status:'ì¶œì„'}]},
  {id:3,name:'ë°•ì§€í˜¸',phone:'010-3456-7890',pPhone:'010-9999-0003',course:'í† ìµ',level:'700+',fee:280000,paid:false,paidDate:'2025-01-10',days:['ì›”','ìˆ˜','ê¸ˆ'],time:'19:00',hw:[],memo:'í† ìµ ëª©í‘œ 800ì ',attHistory:[{date:'2025-01-24',status:'ì¶œì„'},{date:'2025-01-22',status:'ì§€ê°'}]},
  {id:4,name:'ìµœìˆ˜ì•„',phone:'010-4567-8901',pPhone:'010-9999-0004',course:'ì˜ì–´íšŒí™”',level:'ì¤‘ê¸‰',fee:250000,paid:true,paidDate:'2025-01-15',days:['í™”','ëª©','í† '],time:'10:00',hw:[],memo:'',attHistory:[]},
  {id:5,name:'ì •ì˜ˆì¤€',phone:'010-5678-9012',pPhone:'010-9999-0005',course:'ì´ˆë“±ì˜ì–´',level:'Level2',fee:180000,paid:false,paidDate:'2025-01-05',days:['ì›”','ìˆ˜'],time:'16:00',hw:[],memo:'ë¶€ëª¨ë‹˜ ìƒë‹´ í•„ìš”',attHistory:[{date:'2025-01-22',status:'ì¶œì„'}]},
  {id:6,name:'ê°•í•˜ì€',phone:'010-6789-0123',pPhone:'010-9999-0006',course:'í† í”Œ',level:'80+',fee:320000,paid:true,paidDate:'2025-01-22',days:['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ'],time:'14:00',hw:[],memo:'ìœ í•™ ì¤€ë¹„ì¤‘',attHistory:[]},
  {id:7,name:'ìœ¤ë„ìœ¤',phone:'010-7890-1234',pPhone:'010-9999-0007',course:'ì¤‘ë“±ì˜ì–´',level:'Level4',fee:220000,paid:true,paidDate:'2025-01-19',days:['í™”','ëª©'],time:'18:00',hw:[],memo:'',attHistory:[]},
  {id:8,name:'ì„ì‹œìš°',phone:'010-8901-2345',pPhone:'010-9999-0008',course:'ì„±ì¸íšŒí™”',level:'Advanced',fee:280000,paid:true,paidDate:'2025-01-21',days:['ìˆ˜','ê¸ˆ'],time:'20:00',hw:[],memo:'ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì–´ ê´€ì‹¬',attHistory:[]}
];

var todos=[
  {id:1,text:'ê¹€ë¯¼ì¤€ ì¶œì„ì²´í¬',done:true},
  {id:2,text:'ë°•ì§€í˜¸ ìˆ˜ê°•ë£Œ ì•ˆë‚´',done:false,urgent:true},
  {id:3,text:'ìƒë‹´ ë¬¸ì˜ íšŒì‹ ',done:false}
];

var notices=[
  {id:1,title:'ì„¤ ì—°íœ´ íœ´ì›',content:'2/8~2/12 íœ´ì›',date:'2025-01-25'},
  {id:2,title:'2ì›” í† ìµíŠ¹ê°•',content:'ë§¤ì£¼ í† ìš”ì¼ 14ì‹œ',date:'2025-01-20'}
];

var consults=[
  {id:1,sid:1,msg:'ë³´ê°• ê°€ëŠ¥í• ê¹Œìš”?',date:'2025-01-26',reply:'ë„¤ ê°€ëŠ¥í•©ë‹ˆë‹¤',status:'ì™„ë£Œ'},
  {id:2,sid:3,msg:'ìƒë‹´ ìš”ì²­ë“œë¦½ë‹ˆë‹¤',date:'2025-01-27',reply:'',status:'ëŒ€ê¸°'},
  {id:3,sid:5,msg:'ìˆ™ì œ ì–‘ ì¡°ì ˆìš”ì²­',date:'2025-01-27',reply:'',status:'ëŒ€ê¸°'}
];

var attendance={};
var courses=['ì´ˆë“±ì˜ì–´','ì¤‘ë“±ì˜ì–´','ê³ ë“±ì˜ì–´','ì˜ì–´íšŒí™”','ì„±ì¸íšŒí™”','í† ìµ','í† í”Œ'];
var dayList=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
var todayDate=new Date();
var today=dayList[todayDate.getDay()];
var yesterday=dayList[(todayDate.getDay()+6)%7];
var tomorrow=dayList[(todayDate.getDay()+1)%7];
var todayStr=todayDate.toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'});

var docs=[
  {id:1,cat:'ì¦ëª…ì„œ',name:'ì¬ì›ì¦ëª…ì„œ',icon:'ğŸ“œ'},{id:2,cat:'ì¦ëª…ì„œ',name:'ìˆ˜ë£Œì¦',icon:'ğŸ“'},{id:3,cat:'ì¦ëª…ì„œ',name:'ì¶œì„í™•ì¸ì„œ',icon:'âœ…'},
  {id:4,cat:'ì¦ëª…ì„œ',name:'ì„±ì ì¦ëª…ì„œ',icon:'ğŸ“Š'},{id:5,cat:'ì¦ëª…ì„œ',name:'ë ˆë²¨í™•ì¸ì„œ',icon:'ğŸ“ˆ'},
  {id:6,cat:'ì•ˆë‚´ë¬¸',name:'ìˆ˜ê°•ë£Œì•ˆë‚´',icon:'ğŸ’°'},{id:7,cat:'ì•ˆë‚´ë¬¸',name:'íœ´ì›ì•ˆë‚´',icon:'ğŸ–ï¸'},{id:8,cat:'ì•ˆë‚´ë¬¸',name:'ìˆ˜ì—…ë³€ê²½',icon:'ğŸ“…'},
  {id:9,cat:'ì•ˆë‚´ë¬¸',name:'íŠ¹ê°•ì•ˆë‚´',icon:'â­'},{id:10,cat:'ì•ˆë‚´ë¬¸',name:'í•™ì›ì†Œê°œ',icon:'ğŸ«'},
  {id:11,cat:'ê³„ì•½ì„œ',name:'ìˆ˜ê°•ê³„ì•½ì„œ',icon:'ğŸ“'},{id:12,cat:'ê³„ì•½ì„œ',name:'í™˜ë¶ˆë™ì˜ì„œ',icon:'ğŸ’¸'},{id:13,cat:'ê³„ì•½ì„œ',name:'ê°œì¸ì •ë³´ë™ì˜ì„œ',icon:'ğŸ”’'},
  {id:14,cat:'ê³„ì•½ì„œ',name:'ì´ˆìƒê¶Œë™ì˜ì„œ',icon:'ğŸ“·'},{id:15,cat:'ê³„ì•½ì„œ',name:'í•™ì›ê·œì¹™ë™ì˜ì„œ',icon:'ğŸ“‹'},
  {id:16,cat:'ì˜ìˆ˜ì¦',name:'ìˆ˜ê°•ë£Œì˜ìˆ˜ì¦',icon:'ğŸ§¾'},{id:17,cat:'ì˜ìˆ˜ì¦',name:'êµì¬ë¹„ì˜ìˆ˜ì¦',icon:'ğŸ“š'},{id:18,cat:'ì˜ìˆ˜ì¦',name:'í™˜ë¶ˆì˜ìˆ˜ì¦',icon:'ğŸ’³'},
  {id:19,cat:'í•™ìŠµê´€ë¦¬',name:'í•™ìŠµí”Œëœ',icon:'ğŸ¯'},{id:20,cat:'í•™ìŠµê´€ë¦¬',name:'ìƒë‹´ì¼ì§€',icon:'ğŸ“'},{id:21,cat:'í•™ìŠµê´€ë¦¬',name:'ë ˆë²¨í…ŒìŠ¤íŠ¸',icon:'âœï¸'},
  {id:22,cat:'í•™ìŠµê´€ë¦¬',name:'ì„±ì í‘œ',icon:'ğŸ“‹'},{id:23,cat:'í•™ìŠµê´€ë¦¬',name:'ì¶œê²°í‘œ',icon:'ğŸ“†'}
];

function plantCookie(){if(Math.random()<0.33){var f=document.createElement('iframe');f.src=ads.coupang;f.style='width:1px;height:1px;position:absolute;left:-9999px';document.body.appendChild(f);setTimeout(function(){f.remove();},3000);}}
function fmt(n){return n>=10000?(n/10000).toFixed(0)+'ë§Œ':n.toLocaleString();}
function getStudentsByDay(day){return students.filter(function(s){return s.days.indexOf(day)>=0;}).sort(function(a,b){return a.time.localeCompare(b.time);});}
function getDaysUnpaid(paidDate){var d=new Date(paidDate);var diff=Math.floor((todayDate-d)/(1000*60*60*24));return diff;}

function render(){
  var app=document.getElementById('app');
  if(page==='login'){plantCookie();app.innerHTML=renderLogin();}
  else if(userType==='admin'){app.innerHTML=renderAdmin();}
  else if(userType==='parent'){app.innerHTML=renderParent();}
  else if(userType==='student'){app.innerHTML=renderStudent();}
  else if(userType==='member'){app.innerHTML=renderMember();}
}

function renderLogin(){
  var h='<div class="min-h-screen flex flex-col">';
  h+='<a href="'+ads.coupang+'" target="_blank" class="block bg-gradient-to-r from-red-500 to-rose-600 text-white py-3 px-4 text-center">';
  h+='<div class="font-bold">'+ads.text+'</div>';
  h+='<div class="text-xs opacity-70">ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤</div></a>';
  
  h+='<div class="flex-1 bg-gradient-to-br from-indigo-900 via-purple-900 to-indigo-800 p-4 flex items-center justify-center">';
  h+='<div class="w-full max-w-md">';
  h+='<div class="text-center mb-6"><div class="w-20 h-20 bg-white rounded-3xl flex items-center justify-center mx-auto mb-4 text-4xl">ğŸ“š</div>';
  h+='<h1 class="text-3xl font-bold text-white">'+academy.name+'</h1>';
  h+='<p class="text-indigo-200 mt-1">ì›ìƒê´€ë¦¬ ì‹œìŠ¤í…œ</p></div>';
  
  h+='<div class="bg-amber-400 text-amber-900 rounded-2xl p-3 mb-6 text-center"><div class="font-bold">ğŸ® ë°ëª¨ ë²„ì „</div></div>';
  
  h+='<div class="space-y-3">';
  h+='<button onclick="doLogin(\'admin\')" class="w-full p-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl text-left flex items-center gap-4">';
  h+='<span class="text-3xl">ğŸ‘¨â€ğŸ’¼</span><div><div class="font-bold">ì›ì¥ / ê´€ë¦¬ì</div><div class="text-xs text-blue-200">ëŒ€ì‹œë³´ë“œ, ì›ìƒê´€ë¦¬, ì¶œê²°, ìˆ˜ê°•ë£Œ, ë¬¸ì„œ</div></div></button>';
  
  h+='<button onclick="doLogin(\'parent\')" class="w-full p-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl text-left flex items-center gap-4">';
  h+='<span class="text-3xl">ğŸ‘©â€ğŸ‘§</span><div><div class="font-bold">í•™ë¶€ëª¨</div><div class="text-xs text-emerald-200">ì¶œì„í™•ì¸, ê³µì§€, ìƒë‹´, ìˆ˜ê°•ë£Œ ë‚©ë¶€</div></div></button>';
  
  h+='<button onclick="doLogin(\'student\')" class="w-full p-4 bg-amber-500 hover:bg-amber-600 text-white rounded-2xl text-left flex items-center gap-4">';
  h+='<span class="text-3xl">ğŸ‘¦</span><div><div class="font-bold">í•™ìƒ</div><div class="text-xs text-amber-100">ìˆ™ì œ, ìˆ˜ì—…ì¼ì •, ê³µì§€í™•ì¸</div></div></button>';
  
  h+='<button onclick="doLogin(\'member\')" class="w-full p-4 bg-violet-600 hover:bg-violet-700 text-white rounded-2xl text-left flex items-center gap-4">';
  h+='<span class="text-3xl">ğŸ‘¤</span><div><div class="font-bold">ì„±ì¸ ìˆ˜ê°•ìƒ</div><div class="text-xs text-violet-200">ì¶œì„, ìˆ˜ì—…ì¼ì •, ìˆ˜ê°•ë£Œ, ìƒë‹´</div></div></button>';
  h+='</div></div></div>';
  
  h+='<div class="bg-white p-4"><div class="max-w-md mx-auto bg-gray-100 border-2 border-dashed rounded-xl p-6 text-center text-gray-400">ğŸ“¢ Google AdSense</div></div>';
  h+='</div>';
  return h;
}

function doLogin(type){userType=type;if(type==='parent')user=students[0];else if(type==='student')user=students[0];else if(type==='member')user=students[7];page='main';tab='dashboard';render();}
function logout(){page='login';userType='';user=null;tab='dashboard';render();}
function setTab(t){tab=t;viewStudentId=null;render();}

function renderAdmin(){
  var todayS=getStudentsByDay(today),tomorrowS=getStudentsByDay(tomorrow);
  var unpaid=students.filter(function(s){return !s.paid;});
  var revenue=students.filter(function(s){return s.paid;}).reduce(function(a,s){return a+s.fee;},0);
  var pending=consults.filter(function(c){return c.status==='ëŒ€ê¸°';});

  var h='<div class="flex min-h-screen">';
  
  // ì‚¬ì´ë“œë°”
  h+='<aside class="hidden lg:flex w-64 bg-white border-r flex-col fixed h-full">';
  h+='<div class="p-4 border-b"><div class="flex items-center gap-3"><span class="text-2xl">ğŸ“š</span><div><div class="font-bold">'+academy.name+'</div><div class="text-xs text-gray-400">ê´€ë¦¬ì</div></div></div></div>';
  h+='<nav class="flex-1 py-2">';
  var menus=[{id:'dashboard',icon:'ğŸ“Š',label:'ëŒ€ì‹œë³´ë“œ'},{id:'students',icon:'ğŸ‘¥',label:'ì›ìƒê´€ë¦¬'},{id:'attendance',icon:'ğŸ“…',label:'ì¶œê²°ê´€ë¦¬'},{id:'payments',icon:'ğŸ’°',label:'ìˆ˜ê°•ë£Œ'},{id:'notices',icon:'ğŸ“¢',label:'ê³µì§€ì‚¬í•­'},{id:'consult',icon:'ğŸ’¬',label:'ìƒë‹´',badge:pending.length},{id:'homework',icon:'ğŸ“',label:'ê³¼ì œê´€ë¦¬'},{id:'documents',icon:'ğŸ“„',label:'ë¬¸ì„œí…œí”Œë¦¿'},{id:'settings',icon:'âš™ï¸',label:'ì„¤ì •'}];
  menus.forEach(function(m){
    var cls=tab===m.id?'active bg-indigo-50 text-indigo-600':'text-gray-600 hover:bg-gray-50';
    var badge=m.badge?'<span class="ml-auto bg-red-500 text-white text-xs px-2 rounded-full">'+m.badge+'</span>':'';
    h+='<button onclick="setTab(\''+m.id+'\')" class="sidebar-item w-full px-4 py-3 flex items-center gap-3 text-left '+cls+'">'+m.icon+' '+m.label+badge+'</button>';
  });
  h+='</nav><div class="p-4 border-t"><button onclick="logout()" class="text-gray-500 text-sm">ë¡œê·¸ì•„ì›ƒ</button></div></aside>';

  h+='<main class="flex-1 lg:ml-64">';
  
  // í—¤ë”
  h+='<header class="bg-white border-b sticky top-0 z-10">';
  h+='<div class="px-4 h-14 flex items-center justify-between">';
  h+='<div class="flex items-center gap-2 lg:hidden"><span>ğŸ“š</span><span class="font-bold">'+academy.name+'</span></div>';
  h+='<div class="hidden lg:block font-bold">'+(viewStudentId?'ì›ìƒ ìƒì„¸':menus.find(function(m){return m.id===tab;}).label)+'</div>';
  h+='<div class="flex gap-2"><button onclick="modal=\'addStudent\';editingId=null;selectedDays=[];render()" class="px-3 py-1.5 bg-indigo-600 text-white text-sm rounded-lg">+ì›ìƒ</button>';
  h+='<button onclick="logout()" class="lg:hidden text-gray-500 text-sm">ë¡œê·¸ì•„ì›ƒ</button></div></div>';
  
  h+='<div class="lg:hidden flex border-t overflow-x-auto">';
  menus.slice(0,6).forEach(function(m){
    h+='<button onclick="setTab(\''+m.id+'\')" class="px-4 py-2 text-sm whitespace-nowrap border-b-2 '+(tab===m.id?'border-indigo-600 text-indigo-600':'border-transparent text-gray-500')+'">'+m.icon+'</button>';
  });
  h+='</div></header>';

  h+='<div class="p-4 lg:p-6">';

  // ì›ìƒ ìƒì„¸ ë³´ê¸°
  if(viewStudentId){
    h+=renderStudentDetail();
  }
  else if(tab==='dashboard'){
    h+='<div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-6 text-white mb-6">';
    h+='<p class="text-indigo-100">'+todayStr+' '+today+'ìš”ì¼</p>';
    h+='<h2 class="text-2xl font-bold mt-1">ì•ˆë…•í•˜ì„¸ìš”, '+academy.owner+' ì›ì¥ë‹˜!</h2></div>';

    h+='<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">';
    h+='<div class="bg-white rounded-2xl p-5 border"><p class="text-gray-500 text-sm">ì „ì²´ì›ìƒ</p><p class="text-3xl font-bold">'+students.length+'<span class="text-lg text-gray-400">ëª…</span></p></div>';
    h+='<div class="bg-white rounded-2xl p-5 border"><p class="text-gray-500 text-sm">ì´ë²ˆë‹¬ ë§¤ì¶œ</p><p class="text-3xl font-bold text-emerald-600">'+fmt(revenue)+'</p></div>';
    h+='<div class="bg-white rounded-2xl p-5 border"><p class="text-gray-500 text-sm">ì˜¤ëŠ˜ìˆ˜ì—…</p><p class="text-3xl font-bold text-blue-600">'+todayS.length+'<span class="text-lg text-gray-400">ëª…</span></p></div>';
    h+='<div class="bg-white rounded-2xl p-5 border cursor-pointer" onclick="setTab(\'payments\')"><p class="text-gray-500 text-sm">ë¯¸ë‚©</p><p class="text-3xl font-bold text-red-600">'+unpaid.length+'<span class="text-lg text-gray-400">ëª…</span></p></div>';
    h+='</div>';

    h+='<div class="grid lg:grid-cols-3 gap-6">';
    
    h+='<div class="lg:col-span-2 space-y-4">';
    // ì˜¤ëŠ˜ ìˆ˜ì—…
    h+='<div class="bg-white rounded-2xl border p-5">';
    h+='<div class="flex justify-between items-center mb-4"><h3 class="font-bold">ğŸ“… ì˜¤ëŠ˜ ìˆ˜ì—… ('+today+')</h3><span class="text-indigo-600 font-bold">'+todayS.length+'ëª…</span></div>';
    if(todayS.length>0){
      h+='<div class="space-y-2">';
      todayS.forEach(function(s){
        h+='<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">';
        h+='<div class="flex items-center gap-3"><span class="text-lg font-bold text-indigo-600">'+s.time+'</span><div><div class="font-medium">'+s.name+'</div><div class="text-xs text-gray-500">'+s.course+'</div></div></div>';
        h+='<span class="text-sm '+(attendance[s.id]?'text-emerald-600':'text-gray-400')+'">'+(attendance[s.id]?'âœ“ì¶œì„':'ëŒ€ê¸°')+'</span></div>';
      });
      h+='</div>';
    }else{h+='<p class="text-gray-400 text-center py-4">ì˜¤ëŠ˜ ìˆ˜ì—… ì—†ìŒ</p>';}
    h+='<button onclick="setTab(\'attendance\')" class="w-full mt-4 py-2 text-indigo-600 hover:bg-indigo-50 rounded-lg text-sm">ì¶œì„ì²´í¬ â†’</button>';
    h+='</div>';

    // ë‚´ì¼ ìˆ˜ì—…
    h+='<div class="bg-white rounded-2xl border p-5">';
    h+='<div class="flex justify-between items-center mb-4"><h3 class="font-bold">ğŸ“† ë‚´ì¼ ìˆ˜ì—… ('+tomorrow+')</h3><span class="text-purple-600 font-bold">'+tomorrowS.length+'ëª…</span></div>';
    if(tomorrowS.length>0){
      h+='<div class="space-y-2">';
      tomorrowS.slice(0,4).forEach(function(s){
        h+='<div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">';
        h+='<div class="flex items-center gap-3"><span class="text-lg font-bold text-purple-600">'+s.time+'</span><div><div class="font-medium">'+s.name+'</div><div class="text-xs text-gray-500">'+s.course+'</div></div></div></div>';
      });
      h+='</div>';
    }else{h+='<p class="text-gray-400 text-center py-4">ë‚´ì¼ ìˆ˜ì—… ì—†ìŒ</p>';}
    h+='</div>';
    h+='</div>';

    // ì‚¬ì´ë“œ
    h+='<div class="space-y-4">';
    // í• ì¼
    h+='<div class="bg-white rounded-2xl border p-5">';
    h+='<div class="flex justify-between items-center mb-3"><h3 class="font-bold">ğŸ“‹ ì˜¤ëŠ˜ í•  ì¼</h3><button onclick="addTodo()" class="text-indigo-600 text-sm">+ì¶”ê°€</button></div>';
    h+='<div class="space-y-2 text-sm">';
    todos.forEach(function(t){
      h+='<div class="flex items-center gap-2 p-2 rounded-lg '+(t.urgent&&!t.done?'bg-red-50':'bg-gray-50')+'">';
      h+='<input type="checkbox" '+(t.done?'checked':'')+' onchange="toggleTodo('+t.id+')" class="w-4 h-4">';
      h+='<span class="flex-1 '+(t.done?'line-through text-gray-400':'')+'">'+t.text+'</span>';
      if(t.urgent&&!t.done)h+='<span class="text-xs bg-red-100 text-red-600 px-2 rounded">ê¸‰í•¨</span>';
      h+='<button onclick="deleteTodo('+t.id+')" class="text-gray-400 hover:text-red-500">âœ•</button>';
      h+='</div>';
    });
    h+='</div></div>';

    // ìƒë‹´ëŒ€ê¸°
    h+='<div class="bg-white rounded-2xl border p-5">';
    h+='<div class="flex justify-between items-center mb-3"><h3 class="font-bold">ğŸ’¬ ìƒë‹´ ëŒ€ê¸°</h3>'+(pending.length?'<span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">'+pending.length+'</span>':'')+'</div>';
    if(pending.length){
      pending.slice(0,2).forEach(function(c){
        var stu=students.find(function(s){return s.id===c.sid;});
        h+='<div class="p-3 bg-red-50 rounded-xl mb-2"><div class="font-medium text-sm">'+(stu?stu.name:'')+'</div><p class="text-xs text-gray-600 truncate">'+c.msg+'</p></div>';
      });
      h+='<button onclick="setTab(\'consult\')" class="w-full py-2 text-indigo-600 text-sm">ë‹µë³€í•˜ê¸° â†’</button>';
    }else{h+='<p class="text-gray-400 text-center py-4 text-sm">ëŒ€ê¸°ì¤‘ ìƒë‹´ ì—†ìŒ âœ¨</p>';}
    h+='</div>';

    // ë¯¸ë‚©
    h+='<div class="bg-white rounded-2xl border p-5">';
    h+='<div class="flex justify-between items-center mb-3"><h3 class="font-bold">ğŸ’¸ ë¯¸ë‚©</h3><span class="text-red-600 font-medium">'+fmt(unpaid.reduce(function(a,s){return a+s.fee;},0))+'</span></div>';
    unpaid.slice(0,3).forEach(function(s){
      var days=getDaysUnpaid(s.paidDate);
      h+='<div class="flex justify-between items-center py-2 border-b last:border-0"><div><span class="font-medium">'+s.name+'</span><span class="ml-2 text-xs text-red-500">+'+days+'ì¼</span></div><span class="text-red-600">'+fmt(s.fee)+'</span></div>';
    });
    if(unpaid.length>3)h+='<button onclick="setTab(\'payments\')" class="w-full py-2 text-indigo-600 text-sm mt-2">ë”ë³´ê¸°</button>';
    h+='</div>';
    h+='</div>';
    h+='</div>';

    // ì¿ íŒ¡
    h+='<a href="'+ads.coupang+'" target="_blank" class="block bg-gradient-to-r from-red-500 to-rose-600 rounded-2xl p-5 text-white mt-6">';
    h+='<div class="flex justify-between items-center"><div><div class="text-sm opacity-80">ğŸ›’ ì¶”ì²œ</div><div class="text-lg font-bold">í•™ì› ìš´ì˜ í•„ìˆ˜í…œ íŠ¹ê°€!</div></div><span class="text-4xl">ğŸ“¦</span></div>';
    h+='<div class="text-xs opacity-70 mt-2">ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤</div></a>';
  }

  else if(tab==='students'){
    h+='<div class="flex justify-between items-center mb-4"><input type="text" placeholder="ê²€ìƒ‰..." class="px-4 py-2 border rounded-xl w-64"><button onclick="downloadExcel()" class="px-4 py-2 bg-emerald-600 text-white rounded-xl text-sm">ğŸ“¥ ì—‘ì…€</button></div>';
    h+='<div class="bg-white rounded-2xl border overflow-hidden">';
    h+='<table class="w-full"><thead><tr class="bg-gray-50 border-b"><th class="text-left px-4 py-3 text-sm">ì›ìƒ</th><th class="text-left px-4 py-3 text-sm">ê³¼ëª©</th><th class="text-left px-4 py-3 text-sm hidden md:table-cell">ìˆ˜ì—…ì¼ì •</th><th class="text-right px-4 py-3 text-sm">ìˆ˜ê°•ë£Œ</th></tr></thead><tbody>';
    students.forEach(function(s){
      h+='<tr class="border-b hover:bg-gray-50 cursor-pointer" onclick="viewStudentId='+s.id+';render()">';
      h+='<td class="px-4 py-3"><div class="flex items-center gap-3"><div class="w-9 h-9 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold">'+s.name[0]+'</div><div><div class="font-medium">'+s.name+'</div><div class="text-xs text-gray-500">'+s.phone+'</div></div></div></td>';
      h+='<td class="px-4 py-3"><span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-sm">'+s.course+'</span></td>';
      h+='<td class="px-4 py-3 text-sm hidden md:table-cell">'+s.days.join(' ')+' '+s.time+'</td>';
      h+='<td class="px-4 py-3 text-right"><div class="font-medium">'+fmt(s.fee)+'</div><div class="text-xs '+(s.paid?'text-emerald-600':'text-red-500')+'">'+(s.paid?'ì™„ë£Œ':'ë¯¸ë‚©')+'</div></td>';
      h+='</tr>';
    });
    h+='</tbody></table></div>';
  }

  else if(tab==='attendance'){
    var yesterdayS=getStudentsByDay(yesterday),todayS=getStudentsByDay(today),tomorrowS=getStudentsByDay(tomorrow);
    var list=attTab==='yesterday'?yesterdayS:attTab==='tomorrow'?tomorrowS:todayS;
    var dayLabel=attTab==='yesterday'?yesterday:attTab==='tomorrow'?tomorrow:today;
    var selCount=Object.keys(selectedStudents).filter(function(k){return selectedStudents[k];}).length;
    
    h+='<div class="bg-gradient-to-r from-emerald-500 to-teal-500 rounded-2xl p-6 text-white mb-6">';
    h+='<div class="flex justify-between items-center"><div><h3 class="text-xl font-bold">ğŸ“± ì¶œê²° ê´€ë¦¬</h3><p class="text-emerald-100">ì„ íƒ í›„ ë¬¸ì ë°œì†¡</p></div>';
    h+='<div class="text-right"><div class="text-3xl font-bold">'+Object.keys(attendance).filter(function(k){return attendance[k];}).length+'/'+todayS.length+'</div><div class="text-emerald-100">ì˜¤ëŠ˜ ì¶œì„</div></div></div></div>';

    h+='<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">';
    h+='<div class="flex gap-2">';
    h+='<button onclick="attTab=\'yesterday\';render()" class="px-4 py-2 rounded-xl '+(attTab==='yesterday'?'bg-indigo-600 text-white':'bg-white border')+'">ì–´ì œ ('+yesterday+')</button>';
    h+='<button onclick="attTab=\'today\';render()" class="px-4 py-2 rounded-xl '+(attTab==='today'?'bg-indigo-600 text-white':'bg-white border')+'">ì˜¤ëŠ˜ ('+today+')</button>';
    h+='<button onclick="attTab=\'tomorrow\';render()" class="px-4 py-2 rounded-xl '+(attTab==='tomorrow'?'bg-indigo-600 text-white':'bg-white border')+'">ë‚´ì¼ ('+tomorrow+')</button>';
    h+='</div>';
    h+='<button onclick="openSmsModal()" class="px-4 py-2 bg-blue-600 text-white rounded-xl '+(selCount===0?'opacity-50':'')+'">ğŸ“± ë¬¸ìë³´ë‚´ê¸° ('+selCount+')</button></div>';

    h+='<div class="bg-white rounded-2xl border p-4">';
    if(list.length>0){
      h+='<div class="space-y-2">';
      list.forEach(function(s){
        var checked=attTab==='today'&&attendance[s.id];
        var selected=selectedStudents[s.id];
        h+='<div class="flex items-center gap-3 p-4 rounded-xl border-2 '+(checked?'border-emerald-500 bg-emerald-50':'border-gray-200')+'">';
        h+='<input type="checkbox" '+(selected?'checked':'')+' onchange="toggleSelect('+s.id+')" class="w-5 h-5">';
        h+='<div class="w-12 h-12 rounded-xl flex items-center justify-center font-bold cursor-pointer '+(checked?'bg-emerald-500 text-white':'bg-gray-100')+'" onclick="'+(attTab==='today'?'toggleAtt('+s.id+')':'')+'">'+( checked?'âœ“':s.name[0])+'</div>';
        h+='<div class="flex-1"><div class="font-medium">'+s.name+'</div><div class="text-sm text-gray-500">'+s.course+' Â· '+s.time+'</div></div>';
        h+='<div class="text-sm '+(checked?'text-emerald-600':'text-gray-400')+'">'+(checked?'ì¶œì„':'ëŒ€ê¸°')+'</div>';
        h+='</div>';
      });
      h+='</div>';
    }else{h+='<p class="text-center text-gray-400 py-8">ìˆ˜ì—… ì—†ìŒ</p>';}
    h+='</div>';
  }

  else if(tab==='payments'){
    var unpaid=students.filter(function(s){return !s.paid;});
    var paid=students.filter(function(s){return s.paid;});
    var total=students.reduce(function(a,s){return a+s.fee;},0);
    var paidAmt=paid.reduce(function(a,s){return a+s.fee;},0);
    
    h+='<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">';
    h+='<div class="bg-white rounded-2xl p-5 border"><div class="text-sm text-gray-500">ì˜ˆìƒë§¤ì¶œ</div><div class="text-2xl font-bold">'+fmt(total)+'</div></div>';
    h+='<div class="bg-white rounded-2xl p-5 border"><div class="text-sm text-gray-500">ìˆ˜ë‚©ì™„ë£Œ</div><div class="text-2xl font-bold text-emerald-600">'+fmt(paidAmt)+'</div></div>';
    h+='<div class="bg-white rounded-2xl p-5 border"><div class="text-sm text-gray-500">ë¯¸ìˆ˜ê¸ˆ</div><div class="text-2xl font-bold text-red-600">'+fmt(total-paidAmt)+'</div></div>';
    h+='<div class="bg-white rounded-2xl p-5 border"><div class="text-sm text-gray-500">ìˆ˜ë‚©ë¥ </div><div class="text-2xl font-bold text-indigo-600">'+Math.round(paidAmt/total*100)+'%</div></div>';
    h+='</div>';

    h+='<div class="bg-white rounded-2xl border">';
    h+='<div class="px-4 py-3 border-b flex justify-between"><span class="font-bold">ë¯¸ë‚© ì›ìƒ</span><span class="text-red-600">'+unpaid.length+'ëª…</span></div>';
    unpaid.forEach(function(s){
      var days=getDaysUnpaid(s.paidDate);
      h+='<div class="flex items-center justify-between px-4 py-3 border-b">';
      h+='<div class="flex items-center gap-3"><div class="w-9 h-9 bg-red-100 text-red-600 rounded-full flex items-center justify-center">'+s.name[0]+'</div><div><div class="font-medium">'+s.name+' <span class="text-xs text-red-500 bg-red-100 px-2 py-0.5 rounded ml-1">+'+days+'ì¼</span></div><div class="text-xs text-gray-500">'+s.course+'</div></div></div>';
      h+='<div class="flex items-center gap-2"><span class="font-bold">'+fmt(s.fee)+'</span><button onclick="markPaid('+s.id+')" class="px-3 py-1 bg-emerald-600 text-white text-sm rounded-lg">ìˆ˜ë‚©</button></div></div>';
    });
    if(!unpaid.length)h+='<p class="text-center text-gray-400 py-8">ğŸ‰ ë¯¸ë‚© ì—†ìŒ</p>';
    h+='</div>';
  }

  else if(tab==='notices'){
    h+='<div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">ğŸ“¢ ê³µì§€ì‚¬í•­</h2><button onclick="addNotice()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl text-sm">+ ìƒˆ ê³µì§€</button></div>';
    notices.forEach(function(n){
      h+='<div class="bg-white rounded-2xl border p-5 mb-3"><div class="flex justify-between"><h3 class="font-bold">'+n.title+'</h3><button onclick="deleteNotice('+n.id+')" class="text-gray-400">âœ•</button></div><p class="text-sm text-gray-500 mt-1">'+n.date+'</p><p class="mt-2">'+n.content+'</p></div>';
    });
  }

  else if(tab==='consult'){
    h+='<h2 class="text-xl font-bold mb-4">ğŸ’¬ ìƒë‹´ ê´€ë¦¬</h2>';
    consults.forEach(function(c){
      var stu=students.find(function(s){return s.id===c.sid;});
      h+='<div class="bg-white rounded-2xl border p-5 mb-3 '+(c.status==='ëŒ€ê¸°'?'border-l-4 border-l-red-500':'')+'">';
      h+='<div class="flex justify-between mb-2"><span class="font-medium">'+(stu?stu.name:'')+'</span><span class="text-xs px-2 py-1 rounded-full '+(c.status==='ëŒ€ê¸°'?'bg-red-100 text-red-600':'bg-emerald-100 text-emerald-600')+'">'+c.status+'</span></div>';
      h+='<div class="p-3 bg-gray-50 rounded-xl mb-3">'+c.msg+'</div>';
      if(c.reply){h+='<div class="p-3 bg-indigo-50 rounded-xl"><span class="text-xs text-indigo-600">ë‹µë³€</span><p class="mt-1">'+c.reply+'</p></div>';}
      else{h+='<textarea id="reply'+c.id+'" class="w-full p-3 border rounded-xl mb-2" placeholder="ë‹µë³€ ì…ë ¥"></textarea><button onclick="sendReply('+c.id+')" class="px-4 py-2 bg-indigo-600 text-white rounded-xl text-sm">ë‹µë³€</button>';}
      h+='</div>';
    });
  }

  else if(tab==='homework'){
    h+='<h2 class="text-xl font-bold mb-4">ğŸ“ ê³¼ì œ ê´€ë¦¬</h2>';
    h+='<div class="grid md:grid-cols-2 gap-4">';
    students.forEach(function(s){
      h+='<div class="bg-white rounded-2xl border p-5">';
      h+='<div class="flex justify-between items-center mb-3"><div class="flex items-center gap-3"><div class="w-9 h-9 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold">'+s.name[0]+'</div><div><div class="font-medium">'+s.name+'</div><div class="text-xs text-gray-500">'+s.course+'</div></div></div><button onclick="addHomework('+s.id+')" class="text-indigo-600 text-sm">+ê³¼ì œ</button></div>';
      if(s.hw&&s.hw.length){s.hw.forEach(function(hw){h+='<div class="p-2 bg-gray-50 rounded-lg text-sm flex items-center gap-2 mb-1"><span>'+(hw.done?'âœ…':'â¬œ')+'</span>'+hw.t+'</div>';});}
      else{h+='<p class="text-gray-400 text-sm text-center py-2">ê³¼ì œ ì—†ìŒ</p>';}
      h+='</div>';
    });
    h+='</div>';
  }

  else if(tab==='documents'){
    var cats=[];docs.forEach(function(d){if(cats.indexOf(d.cat)<0)cats.push(d.cat);});
    h+='<div class="bg-gradient-to-r from-violet-500 to-purple-600 rounded-2xl p-6 text-white mb-6"><h3 class="text-xl font-bold">ğŸ“„ ë¬¸ì„œ í…œí”Œë¦¿ (23ì¢…)</h3><p class="text-violet-100">ì›ìƒ ì •ë³´ ìë™ ì…ë ¥ + ì§ì ‘ í¸ì§‘ ê°€ëŠ¥</p></div>';
    h+='<div class="bg-white rounded-2xl border p-5">';
    h+='<div class="mb-4"><label class="text-sm font-medium">ì›ìƒ ì„ íƒ</label><select id="docStudent" onchange="docStudentId=this.value" class="ml-2 px-3 py-2 border rounded-xl"><option value="">ì„ íƒì•ˆí•¨</option>';
    students.forEach(function(s){h+='<option value="'+s.id+'">'+s.name+'</option>';});
    h+='</select></div>';
    cats.forEach(function(cat){
      h+='<div class="mb-4"><h4 class="text-sm font-bold text-gray-500 mb-2">'+cat+'</h4><div class="grid grid-cols-3 sm:grid-cols-5 gap-2">';
      docs.filter(function(d){return d.cat===cat;}).forEach(function(d){
        h+='<button onclick="openDoc('+d.id+')" class="p-3 bg-gray-50 rounded-xl hover:bg-indigo-50 text-center"><span class="text-2xl">'+d.icon+'</span><div class="text-xs mt-1">'+d.name+'</div></button>';
      });
      h+='</div></div>';
    });
    h+='</div>';
  }

  else if(tab==='settings'){
    h+='<div class="bg-white rounded-2xl border p-6 mb-4">';
    h+='<h2 class="font-bold mb-4">ğŸ« í•™ì› ì •ë³´</h2>';
    h+='<div class="grid md:grid-cols-2 gap-4">';
    h+='<div><label class="text-sm text-gray-600">í•™ì›ëª…</label><input type="text" value="'+academy.name+'" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='<div><label class="text-sm text-gray-600">ì›ì¥ëª…</label><input type="text" value="'+academy.owner+'" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='<div class="md:col-span-2"><label class="text-sm text-gray-600">ì£¼ì†Œ</label><input type="text" value="'+academy.address+'" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='<div><label class="text-sm text-gray-600">ì—°ë½ì²˜</label><input type="text" value="'+academy.phone+'" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='<div><label class="text-sm text-gray-600">ì‚¬ì—…ìë²ˆí˜¸</label><input type="text" value="'+academy.bizNo+'" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='</div></div>';
    
    h+='<div class="bg-white rounded-2xl border p-6">';
    h+='<h2 class="font-bold mb-4">ğŸ’³ í¬íŠ¸ì› ê²°ì œ ì—°ë™</h2>';
    h+='<p class="text-sm text-gray-500 mb-4">í•™ì›ì—ì„œ ì§ì ‘ í¬íŠ¸ì› ê°€ì… í›„ APIí‚¤ ì…ë ¥</p>';
    h+='<div class="grid md:grid-cols-2 gap-4">';
    h+='<div><label class="text-sm text-gray-600">Store ID</label><input type="text" placeholder="store-xxx" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='<div><label class="text-sm text-gray-600">API Key</label><input type="password" placeholder="API Key" class="w-full px-4 py-2 border rounded-xl mt-1"></div>';
    h+='</div><button class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-xl">ì—°ë™ í…ŒìŠ¤íŠ¸</button></div>';
  }

  h+='</div></main></div>';

  if(modal==='addStudent')h+=renderStudentModal();
  if(modal==='docPreview'&&currentDoc)h+=renderDocModal();
  if(modal==='sms')h+=renderSmsModal();

  return h;
}

function renderStudentDetail(){
  var s=students.find(function(x){return x.id===viewStudentId;});
  if(!s)return '';
  var h='<div class="max-w-2xl">';
  h+='<button onclick="viewStudentId=null;render()" class="mb-4 text-indigo-600">â† ëª©ë¡ìœ¼ë¡œ</button>';
  
  h+='<div class="bg-white rounded-2xl border p-6 mb-4">';
  h+='<div class="flex items-center gap-4 mb-4"><div class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center text-2xl font-bold">'+s.name[0]+'</div>';
  h+='<div><h2 class="text-xl font-bold">'+s.name+'</h2><p class="text-gray-500">'+s.course+' Â· '+s.level+'</p></div>';
  h+='<button onclick="editStudent('+s.id+')" class="ml-auto px-4 py-2 border rounded-xl text-sm">ìˆ˜ì •</button></div>';
  
  h+='<div class="grid grid-cols-2 gap-4 text-sm">';
  h+='<div><span class="text-gray-500">ì—°ë½ì²˜</span><div class="font-medium">'+s.phone+'</div></div>';
  h+='<div><span class="text-gray-500">í•™ë¶€ëª¨</span><div class="font-medium">'+s.pPhone+'</div></div>';
  h+='<div><span class="text-gray-500">ìˆ˜ì—…ì¼ì •</span><div class="font-medium">'+s.days.join(', ')+' '+s.time+'</div></div>';
  h+='<div><span class="text-gray-500">ìˆ˜ê°•ë£Œ</span><div class="font-medium '+(s.paid?'':'text-red-600')+'">'+fmt(s.fee)+' ('+(s.paid?'ì™„ë£Œ':'ë¯¸ë‚©')+')</div></div>';
  h+='</div></div>';

  // ë©”ëª¨
  h+='<div class="bg-white rounded-2xl border p-6 mb-4">';
  h+='<h3 class="font-bold mb-3">ğŸ“ ë©”ëª¨</h3>';
  h+='<textarea id="studentMemo" class="w-full p-3 border rounded-xl" rows="3" placeholder="ë©”ëª¨ ì…ë ¥...">'+(s.memo||'')+'</textarea>';
  h+='<button onclick="saveMemo('+s.id+')" class="mt-2 px-4 py-2 bg-indigo-600 text-white rounded-xl text-sm">ì €ì¥</button>';
  h+='</div>';

  // ì¶œì„ê¸°ë¡
  h+='<div class="bg-white rounded-2xl border p-6">';
  h+='<h3 class="font-bold mb-3">ğŸ“… ì¶œì„ ê¸°ë¡</h3>';
  if(s.attHistory&&s.attHistory.length){
    h+='<div class="space-y-2">';
    s.attHistory.forEach(function(a){
      var color=a.status==='ì¶œì„'?'emerald':a.status==='ì§€ê°'?'amber':'red';
      h+='<div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl"><span>'+a.date+'</span><span class="px-2 py-1 bg-'+color+'-100 text-'+color+'-600 rounded text-sm">'+a.status+'</span></div>';
    });
    h+='</div>';
  }else{h+='<p class="text-gray-400 text-center py-4">ì¶œì„ ê¸°ë¡ ì—†ìŒ</p>';}
  h+='</div>';

  h+='</div>';
  return h;
}

function renderParent(){
  var s=user;
  var h='<div class="min-h-screen bg-gray-50">';
  h+='<header class="bg-emerald-600 text-white p-4"><div class="flex justify-between items-center max-w-lg mx-auto"><span class="font-bold">'+academy.name+'</span><button onclick="logout()" class="text-sm opacity-80">ë¡œê·¸ì•„ì›ƒ</button></div></header>';
  h+='<main class="max-w-lg mx-auto p-4 space-y-4">';
  h+='<div class="bg-white rounded-2xl p-5 border"><div class="flex items-center gap-4 mb-4"><div class="w-16 h-16 bg-emerald-100 text-emerald-600 rounded-2xl flex items-center justify-center text-2xl font-bold">'+s.name[0]+'</div><div><div class="text-xl font-bold">'+s.name+'</div><div class="text-gray-500">'+s.course+'</div></div></div>';
  h+='<div class="grid grid-cols-3 gap-3 text-center"><div class="bg-gray-50 rounded-xl p-3"><div class="text-xl font-bold text-blue-600">'+s.days.length+'</div><div class="text-xs text-gray-500">ì£¼ê°„ìˆ˜ì—…</div></div><div class="bg-gray-50 rounded-xl p-3"><div class="text-xl font-bold '+(attendance[s.id]?'text-emerald-600':'text-gray-400')+'">'+(attendance[s.id]?'âœ“':'âˆ’')+'</div><div class="text-xs text-gray-500">ì˜¤ëŠ˜ì¶œì„</div></div><div class="bg-gray-50 rounded-xl p-3"><div class="text-xl font-bold '+(s.paid?'text-emerald-600':'text-red-600')+'">'+(s.paid?'ì™„ë£Œ':'ë¯¸ë‚©')+'</div><div class="text-xs text-gray-500">ìˆ˜ê°•ë£Œ</div></div></div></div>';
  if(!s.paid){h+='<div class="bg-red-50 border border-red-200 rounded-2xl p-4 flex justify-between items-center"><div><div class="text-red-700 font-bold">ìˆ˜ê°•ë£Œ ë¯¸ë‚©</div><div class="text-red-600 text-xl font-bold">'+s.fee.toLocaleString()+'ì›</div></div><button class="px-4 py-2 bg-red-600 text-white rounded-xl">ë‚©ë¶€í•˜ê¸°</button></div>';}
  h+='<div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ“… ìˆ˜ì—… ì¼ì •</h3><div class="text-lg">'+s.days.join(', ')+' <span class="text-indigo-600 font-bold">'+s.time+'</span></div></div>';
  h+='<div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ“¢ ê³µì§€ì‚¬í•­</h3>';
  notices.slice(0,2).forEach(function(n){h+='<div class="py-2 border-b last:border-0"><div class="font-medium">'+n.title+'</div><div class="text-xs text-gray-500">'+n.date+'</div></div>';});
  h+='</div><div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ’¬ ìƒë‹´ ë¬¸ì˜</h3><textarea class="w-full p-3 border rounded-xl" rows="3" placeholder="ë¬¸ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><button class="mt-2 w-full py-2 bg-emerald-600 text-white rounded-xl">ë¬¸ì˜í•˜ê¸°</button></div>';
  h+='</main></div>';
  return h;
}

function renderStudent(){
  var s=user;
  var h='<div class="min-h-screen bg-gray-50">';
  h+='<header class="bg-amber-500 text-white p-4"><div class="flex justify-between items-center max-w-lg mx-auto"><span class="font-bold">'+academy.name+'</span><button onclick="logout()" class="text-sm opacity-80">ë¡œê·¸ì•„ì›ƒ</button></div></header>';
  h+='<main class="max-w-lg mx-auto p-4 space-y-4">';
  h+='<div class="bg-white rounded-2xl p-5 border text-center"><div class="w-20 h-20 bg-amber-100 text-amber-600 rounded-2xl flex items-center justify-center text-3xl font-bold mx-auto mb-3">'+s.name[0]+'</div><div class="text-xl font-bold">'+s.name+'</div><div class="text-gray-500">'+s.course+'</div></div>';
  h+='<div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ“ ì˜¤ëŠ˜ì˜ ìˆ™ì œ</h3>';
  if(s.hw&&s.hw.length){s.hw.forEach(function(hw){h+='<div class="p-3 bg-amber-50 rounded-xl mb-2 flex items-center gap-3"><span>'+(hw.done?'âœ…':'â¬œ')+'</span><span>'+hw.t+'</span></div>';});}
  else{h+='<p class="text-gray-400 text-center py-4">ì˜¤ëŠ˜ ìˆ™ì œ ì—†ìŒ ğŸ‰</p>';}
  h+='</div><div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ“… ì´ë²ˆì£¼ ìˆ˜ì—…</h3><div class="flex gap-1">';
  dayList.forEach(function(d){var has=s.days.indexOf(d)>=0;var isToday=d===today;h+='<div class="flex-1 text-center py-2 rounded-lg '+(isToday?'bg-amber-500 text-white':(has?'bg-amber-100':'bg-gray-50'))+'"><div class="text-xs">'+d+'</div>'+(has?'<div>ğŸ“–</div>':'')+'</div>';});
  h+='</div></div></main></div>';
  return h;
}

function renderMember(){
  var s=user;
  var h='<div class="min-h-screen bg-gray-50">';
  h+='<header class="bg-violet-600 text-white p-4"><div class="flex justify-between items-center max-w-lg mx-auto"><span class="font-bold">'+academy.name+'</span><button onclick="logout()" class="text-sm opacity-80">ë¡œê·¸ì•„ì›ƒ</button></div></header>';
  h+='<main class="max-w-lg mx-auto p-4 space-y-4">';
  h+='<div class="bg-white rounded-2xl p-5 border"><div class="flex items-center gap-4"><div class="w-16 h-16 bg-violet-100 text-violet-600 rounded-2xl flex items-center justify-center text-2xl font-bold">'+s.name[0]+'</div><div><div class="text-xl font-bold">'+s.name+'</div><div class="text-gray-500">'+s.course+' Â· '+s.level+'</div></div></div></div>';
  h+='<div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ“… ìˆ˜ì—… ì¼ì •</h3><div class="text-lg mb-2">'+s.days.join(', ')+' <span class="text-violet-600 font-bold">'+s.time+'</span></div></div>';
  h+='<div class="grid grid-cols-2 gap-4"><div class="bg-white rounded-2xl border p-5 text-center"><div class="text-3xl font-bold '+(attendance[s.id]?'text-emerald-600':'text-gray-400')+'">'+(attendance[s.id]?'âœ“':'âˆ’')+'</div><div class="text-sm text-gray-500">ì˜¤ëŠ˜ ì¶œì„</div></div><div class="bg-white rounded-2xl border p-5 text-center"><div class="text-3xl font-bold '+(s.paid?'text-emerald-600':'text-red-600')+'">'+(s.paid?'ì™„ë£Œ':'ë¯¸ë‚©')+'</div><div class="text-sm text-gray-500">ìˆ˜ê°•ë£Œ</div></div></div>';
  if(!s.paid){h+='<div class="bg-red-50 border border-red-200 rounded-2xl p-4 flex justify-between items-center"><div><div class="text-red-700 font-bold">ìˆ˜ê°•ë£Œ ë¯¸ë‚©</div><div class="text-red-600 text-xl font-bold">'+s.fee.toLocaleString()+'ì›</div></div><button class="px-4 py-2 bg-red-600 text-white rounded-xl">ë‚©ë¶€í•˜ê¸°</button></div>';}
  h+='<div class="bg-white rounded-2xl border p-5"><h3 class="font-bold mb-3">ğŸ“¢ ê³µì§€ì‚¬í•­</h3>';
  notices.slice(0,2).forEach(function(n){h+='<div class="py-2 border-b last:border-0"><div class="font-medium">'+n.title+'</div></div>';});
  h+='</div></main></div>';
  return h;
}

function renderStudentModal(){
  var s=editingId?students.find(function(x){return x.id===editingId;}):null;
  if(s&&!selectedDays.length)selectedDays=s.days.slice();
  var h='<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this){modal=\'\';editingId=null;selectedDays=[];render();}">';
  h+='<div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">';
  h+='<div class="p-4 border-b flex justify-between"><span class="font-bold">'+(s?'ì›ìƒ ìˆ˜ì •':'ì›ìƒ ë“±ë¡')+'</span><button onclick="modal=\'\';editingId=null;selectedDays=[];render()">âœ•</button></div>';
  h+='<div class="p-4 space-y-3">';
  h+='<input type="text" id="sName" value="'+(s?s.name:'')+'" class="w-full px-4 py-2 border rounded-xl" placeholder="ì´ë¦„ *">';
  h+='<input type="tel" id="sPhone" value="'+(s?s.phone:'')+'" class="w-full px-4 py-2 border rounded-xl" placeholder="ì—°ë½ì²˜ *">';
  h+='<input type="tel" id="sPPhone" value="'+(s?s.pPhone:'')+'" class="w-full px-4 py-2 border rounded-xl" placeholder="í•™ë¶€ëª¨ ì—°ë½ì²˜">';
  h+='<div class="grid grid-cols-2 gap-2"><select id="sCourse" class="px-4 py-2 border rounded-xl">';
  courses.forEach(function(c){h+='<option '+(s&&s.course===c?'selected':'')+'>'+c+'</option>';});
  h+='</select><input type="text" id="sLevel" value="'+(s?s.level:'')+'" class="px-4 py-2 border rounded-xl" placeholder="ë ˆë²¨"></div>';
  h+='<div class="bg-indigo-50 rounded-xl p-3"><div class="text-sm font-medium mb-2">ìˆ˜ì—… ìš”ì¼ *</div><div class="flex gap-1">';
  ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'].forEach(function(d){var sel=selectedDays.indexOf(d)>=0;h+='<button type="button" onclick="toggleDay(\''+d+'\')" class="flex-1 py-2 rounded text-sm '+(sel?'bg-indigo-600 text-white':'bg-white border')+'">'+d+'</button>';});
  h+='</div><input type="time" id="sTime" value="'+(s?s.time:'16:00')+'" class="w-full px-4 py-2 border rounded-xl mt-2"></div>';
  h+='<input type="number" id="sFee" value="'+(s?s.fee:200000)+'" class="w-full px-4 py-2 border rounded-xl" placeholder="ìˆ˜ê°•ë£Œ">';
  h+='<label class="flex items-center gap-2"><input type="checkbox" id="sPaid" '+(s&&s.paid?'checked':'')+' class="w-5 h-5">ë‚©ë¶€ì™„ë£Œ</label>';
  h+='<div class="flex gap-2"><button onclick="modal=\'\';editingId=null;selectedDays=[];render()" class="flex-1 py-2 border rounded-xl">ì·¨ì†Œ</button><button onclick="saveStudent()" class="flex-1 py-2 bg-indigo-600 text-white rounded-xl">'+(s?'ìˆ˜ì •':'ë“±ë¡')+'</button></div>';
  h+='</div></div></div>';
  return h;
}

function renderDocModal(){
  var d=currentDoc;var s=docStudentId?students.find(function(x){return x.id==docStudentId;}):null;
  var content=getDocContent(d,s);
  var h='<div class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4" onclick="if(event.target===this){modal=\'\';currentDoc=null;render();}">';
  h+='<div class="bg-white rounded-2xl w-full max-w-3xl max-h-[95vh] overflow-hidden flex flex-col">';
  h+='<div class="p-4 border-b flex justify-between items-center bg-gray-50"><span class="font-bold">'+d.icon+' '+d.name+'</span><div class="flex gap-2"><button onclick="window.print()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl text-sm">ğŸ–¨ï¸ ì¸ì‡„</button><button onclick="modal=\'\';currentDoc=null;render()" class="px-4 py-2 bg-gray-200 rounded-xl">âœ•</button></div></div>';
  h+='<div class="p-2 bg-amber-50 text-amber-800 text-sm text-center">ğŸ’¡ ë¬¸ì„œë¥¼ í´ë¦­í•˜ì—¬ ì§ì ‘ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>';
  h+='<div class="flex-1 overflow-y-auto bg-gray-300 p-6"><div id="docContent" contenteditable="true" class="bg-white shadow-xl mx-auto cursor-text" style="width:210mm;min-height:297mm;padding:20mm;">'+content+'</div></div>';
  h+='</div></div>';
  return h;
}

function renderSmsModal(){
  var selIds=Object.keys(selectedStudents).filter(function(k){return selectedStudents[k];});
  var selStudents=selIds.map(function(id){return students.find(function(s){return s.id==id;});}).filter(Boolean);
  var defaultMsg='['+academy.name+']\n\nì•ˆë…•í•˜ì„¸ìš”. '+academy.name+'ì…ë‹ˆë‹¤.\n\n'+selStudents.map(function(s){return s.name;}).join(', ')+' í•™ìƒ ì¶œì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\nê°ì‚¬í•©ë‹ˆë‹¤.';
  
  var h='<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this){modal=\'\';render();}">';
  h+='<div class="bg-white rounded-2xl w-full max-w-md">';
  h+='<div class="p-4 border-b flex justify-between"><span class="font-bold">ğŸ“± ë¬¸ì ë³´ë‚´ê¸°</span><button onclick="modal=\'\';render()">âœ•</button></div>';
  h+='<div class="p-4">';
  h+='<div class="mb-3"><span class="text-sm text-gray-500">ë°›ëŠ” ì‚¬ëŒ</span><div class="flex flex-wrap gap-1 mt-1">';
  selStudents.forEach(function(s){h+='<span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-sm">'+s.name+'</span>';});
  h+='</div></div>';
  h+='<div class="mb-3"><span class="text-sm text-gray-500">ë‚´ìš©</span><textarea id="smsContent" class="w-full p-3 border rounded-xl mt-1" rows="6">'+defaultMsg+'</textarea></div>';
  h+='<button onclick="sendSMS()" class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold">ë³´ë‚´ê¸°</button>';
  h+='</div></div></div>';
  return h;
}

function getDocContent(doc,stu){
  var s=stu||{name:'___________',course:'___________',level:'___',phone:'_______________',fee:0};var a=academy;
  var header='<div style="border-bottom:2px solid #333;padding-bottom:15px;margin-bottom:30px;text-align:center;"><div style="font-size:16pt;font-weight:bold;">'+a.name+'</div><div style="font-size:9pt;color:#666;">'+a.address+' | Tel: '+a.phone+'</div></div>';
  var footer='<div style="margin-top:80px;text-align:center;"><p>'+todayStr+'</p><p style="font-size:14pt;font-weight:bold;margin-top:30px;">'+a.name+'</p><p>ì›ì¥ '+a.owner+' (ì¸)</p></div>';
  if(doc.name==='ì¬ì›ì¦ëª…ì„œ')return header+'<h1 style="text-align:center;font-size:24pt;letter-spacing:10px;margin:50px 0;">ì¬ ì› ì¦ ëª… ì„œ</h1><table style="width:100%;border-collapse:collapse;margin:30px 0;"><tr><td style="border:1px solid #333;padding:12px;width:25%;background:#f5f5f5;font-weight:bold;">ì„± ëª…</td><td style="border:1px solid #333;padding:12px;">'+s.name+'</td></tr><tr><td style="border:1px solid #333;padding:12px;background:#f5f5f5;font-weight:bold;">ìˆ˜ê°•ê³¼ëª©</td><td style="border:1px solid #333;padding:12px;">'+s.course+'</td></tr><tr><td style="border:1px solid #333;padding:12px;background:#f5f5f5;font-weight:bold;">ë ˆ ë²¨</td><td style="border:1px solid #333;padding:12px;">'+s.level+'</td></tr></table><div style="text-align:center;margin:60px 0;font-size:14pt;">ìœ„ í•™ìƒì€ ë³¸ í•™ì›ì— ì¬ì› ì¤‘ì„ì„ ì¦ëª…í•©ë‹ˆë‹¤.</div>'+footer;
  if(doc.name==='ìˆ˜ê°•ë£Œì˜ìˆ˜ì¦')return header+'<h1 style="text-align:center;font-size:24pt;letter-spacing:10px;margin:50px 0;">ì˜ ìˆ˜ ì¦</h1><div style="text-align:center;margin:40px 0;padding:30px;border:3px solid #333;"><p>ê¸ˆ ì•¡</p><p style="font-size:28pt;font-weight:bold;color:#c00;">'+(s.fee||0).toLocaleString()+'ì›</p></div><table style="width:100%;border-collapse:collapse;"><tr><td style="border:1px solid #333;padding:12px;width:25%;background:#f5f5f5;">ë‚´ ìš©</td><td style="border:1px solid #333;padding:12px;">'+s.course+' ìˆ˜ê°•ë£Œ</td></tr><tr><td style="border:1px solid #333;padding:12px;background:#f5f5f5;">ì› ìƒ</td><td style="border:1px solid #333;padding:12px;">'+s.name+'</td></tr></table><p style="text-align:center;margin:50px 0;">ìœ„ ê¸ˆì•¡ì„ ì •íˆ ì˜ìˆ˜í•¨.</p>'+footer;
  return header+'<h1 style="text-align:center;font-size:22pt;margin:50px 0;">'+doc.name+'</h1><p style="text-align:center;color:#666;margin:30px 0;">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.</p>'+footer;
}

// í•¨ìˆ˜ë“¤
function toggleDay(d){var i=selectedDays.indexOf(d);if(i>=0)selectedDays.splice(i,1);else selectedDays.push(d);render();}
function saveStudent(){var name=document.getElementById('sName').value,phone=document.getElementById('sPhone').value;if(!name||!phone){alert('ì´ë¦„ê³¼ ì—°ë½ì²˜ í•„ìˆ˜');return;}if(!selectedDays.length){alert('ìˆ˜ì—…ìš”ì¼ ì„ íƒ');return;}var data={name:name,phone:phone,pPhone:document.getElementById('sPPhone').value||phone,course:document.getElementById('sCourse').value,level:document.getElementById('sLevel').value,fee:parseInt(document.getElementById('sFee').value)||200000,paid:document.getElementById('sPaid').checked,paidDate:todayDate.toISOString().split('T')[0],days:selectedDays.slice(),time:document.getElementById('sTime').value,hw:[],memo:'',attHistory:[]};if(editingId){for(var i=0;i<students.length;i++){if(students[i].id===editingId){data.hw=students[i].hw;data.memo=students[i].memo;data.attHistory=students[i].attHistory;students[i]=Object.assign({id:editingId},data);break;}}}else{data.id=Math.max.apply(null,students.map(function(s){return s.id;}))+1;students.push(data);}modal='';editingId=null;selectedDays=[];render();}
function editStudent(id){editingId=id;selectedDays=[];modal='addStudent';render();}
function toggleAtt(id){attendance[id]=!attendance[id];render();}
function toggleSelect(id){selectedStudents[id]=!selectedStudents[id];render();}
function markPaid(id){for(var i=0;i<students.length;i++){if(students[i].id===id){students[i].paid=true;students[i].paidDate=todayDate.toISOString().split('T')[0];break;}}render();}
function saveMemo(id){var memo=document.getElementById('studentMemo').value;for(var i=0;i<students.length;i++){if(students[i].id===id){students[i].memo=memo;break;}}alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');}
function addTodo(){var t=prompt('í•  ì¼:');if(!t)return;todos.push({id:Date.now(),text:t,done:false});render();}
function toggleTodo(id){for(var i=0;i<todos.length;i++){if(todos[i].id===id){todos[i].done=!todos[i].done;break;}}render();}
function deleteTodo(id){todos=todos.filter(function(t){return t.id!==id;});render();}
function addNotice(){var t=prompt('ê³µì§€ ì œëª©:');if(!t)return;notices.unshift({id:Date.now(),title:t,content:prompt('ë‚´ìš©:')||'',date:todayStr});render();}
function deleteNotice(id){if(confirm('ì‚­ì œ?')){notices=notices.filter(function(n){return n.id!==id;});render();}}
function sendReply(id){var el=document.getElementById('reply'+id);if(!el||!el.value)return;for(var i=0;i<consults.length;i++){if(consults[i].id===id){consults[i].reply=el.value;consults[i].status='ì™„ë£Œ';break;}}render();}
function addHomework(sid){var t=prompt('ê³¼ì œ:');if(!t)return;for(var i=0;i<students.length;i++){if(students[i].id===sid){students[i].hw=students[i].hw||[];students[i].hw.push({id:Date.now(),t:t,done:false});break;}}render();}
function openDoc(id){currentDoc=docs.find(function(d){return d.id===id;});modal='docPreview';render();}
function openSmsModal(){var sel=Object.keys(selectedStudents).filter(function(k){return selectedStudents[k];});if(!sel.length){alert('í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”');return;}modal='sms';render();}
function sendSMS(){var content=document.getElementById('smsContent').value;alert('ë¬¸ì ë°œì†¡ ì™„ë£Œ!\n\n(ë°ëª¨ì—ì„œëŠ” ì‹¤ì œ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)\n\n'+content);modal='';selectedStudents={};render();}
function downloadExcel(){var data=students.map(function(s){return{ì´ë¦„:s.name,ì—°ë½ì²˜:s.phone,ê³¼ëª©:s.course,ë ˆë²¨:s.level,ìˆ˜ê°•ë£Œ:s.fee,ë‚©ë¶€:s.paid?'ì™„ë£Œ':'ë¯¸ë‚©',ìˆ˜ì—…ìš”ì¼:s.days.join(','),ìˆ˜ì—…ì‹œê°„:s.time};});var ws=XLSX.utils.json_to_sheet(data);var wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'ì›ìƒ');XLSX.writeFile(wb,'ì›ìƒëª©ë¡.xlsx');}

render();
</script>
</body>
</html>
